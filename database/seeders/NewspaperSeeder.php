<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Modules\Blog\Models\Post;
use App\Modules\Blog\Models\BlogCategory;
use App\Modules\Blog\Models\Tag;
use App\Modules\Blog\Services\PostService;
use App\Models\User;
use App\Models\AuthorProfile;
use App\Services\ImageService;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\Hash;
use Illuminate\Http\UploadedFile;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Storage;

class NewspaperSeeder extends Seeder
{
    protected PostService $postService;

    public function __construct(PostService $postService)
    {
        $this->postService = $postService;
    }

    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $this->command->info('ЁЯЧЮя╕П  ржмрж╛ржВрж▓рж╛ рж╕ржВржмрж╛ржжржкрждрзНрж░ ржбрж╛ржЯрж╛ рж╕рзАржбрж╛рж░ рж╢рзБрж░рзБ рж╣ржЪрзНржЫрзЗ...');

        // Get or create default newspaper author
        $author = User::where('email', 'author@newspaper.com')->first();

        if (!$author) {
            // Create default newspaper author user
            $author = User::create([
                'name' => 'рж╕ржВржмрж╛ржжржкрждрзНрж░ рж▓рзЗржЦржХ',
                'email' => 'author@newspaper.com',
                'mobile' => '01800000000',
                'password' => Hash::make('author123'),
                'role' => 'author',
                'email_verified_at' => now(),
                'is_active' => true,
            ]);

            // Create author profile with slug (using existing system)
            $authorProfile = AuthorProfile::firstOrCreate(
                ['user_id' => $author->id],
                [
                    'slug' => Str::slug($author->name), // Will be made unique by HasUniqueSlug trait
                    'bio' => 'ржкрзЗрж╢рж╛ржжрж╛рж░ рж╕ржВржмрж╛ржжржкрждрзНрж░ рж▓рзЗржЦржХ ржПржмржВ рж╕рж╛ржВржмрж╛ржжрж┐ржХред ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржмрж┐ржнрж┐ржирзНржи рж╕ржВржмрж╛ржжржкрждрзНрж░рзЗ ржирж┐ржпрж╝ржорж┐ржд рж▓рзЗржЦрж╛рж▓рзЗржЦрж┐ ржХрж░рзЗржиред',
                    'job_title' => 'рж╕рж┐ржирж┐ржпрж╝рж░ рж╕рж╛ржВржмрж╛ржжрж┐ржХ',
                    'is_featured' => true,
                    'display_order' => 1,
                ]
            );

            $this->command->info('тЬУ ржбрж┐ржлрж▓рзНржЯ рж╕ржВржмрж╛ржжржкрждрзНрж░ рж▓рзЗржЦржХ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ');
            $this->command->info('  ржирж╛ржо: ' . $author->name);
            $this->command->info('  ржЗржорзЗржЗрж▓: author@newspaper.com');
            $this->command->info('  ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб: author123');
            $this->command->info('  ржнрзВржорж┐ржХрж╛: author');
            $this->command->info('  рж╕рзНрж▓рж╛ржЧ: ' . $authorProfile->slug);
        } else {
            $this->command->info('тЬУ ржмрж┐ржжрзНржпржорж╛ржи рж╕ржВржмрж╛ржжржкрждрзНрж░ рж▓рзЗржЦржХ ржкрж╛ржУржпрж╝рж╛ ржЧрзЗржЫрзЗ');

            // Ensure author has author profile (using firstOrCreate to avoid duplicates)
            $authorProfile = AuthorProfile::firstOrCreate(
                ['user_id' => $author->id],
                [
                    'slug' => Str::slug($author->name),
                    'bio' => 'ржкрзЗрж╢рж╛ржжрж╛рж░ рж╕ржВржмрж╛ржжржкрждрзНрж░ рж▓рзЗржЦржХ ржПржмржВ рж╕рж╛ржВржмрж╛ржжрж┐ржХред ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржмрж┐ржнрж┐ржирзНржи рж╕ржВржмрж╛ржжржкрждрзНрж░рзЗ ржирж┐ржпрж╝ржорж┐ржд рж▓рзЗржЦрж╛рж▓рзЗржЦрж┐ ржХрж░рзЗржиред',
                    'job_title' => 'рж╕рж┐ржирж┐ржпрж╝рж░ рж╕рж╛ржВржмрж╛ржжрж┐ржХ',
                    'is_featured' => true,
                    'display_order' => 1,
                ]
            );

            if ($authorProfile->wasRecentlyCreated) {
                $this->command->info('тЬУ рж▓рзЗржЦржХ ржкрзНрж░рзЛржлрж╛ржЗрж▓ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ');
            } else {
                $this->command->info('тЬУ рж▓рзЗржЦржХ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЗрждрж┐ржоржзрзНржпрзЗ ржмрж┐ржжрзНржпржорж╛ржи');
            }
        }

        // Create newspaper categories
        $this->command->info('рж╕ржВржмрж╛ржжржкрждрзНрж░ ржмрж┐ржнрж╛ржЧ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...');
        $categories = $this->createCategories();

        // Create newspaper tags
        $this->command->info('рж╕ржВржмрж╛ржжржкрждрзНрж░ ржЯрзНржпрж╛ржЧ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...');
        $tags = $this->createTags();

        // Create newspaper posts with images from public API
        $this->command->info('ржЫржмрж┐рж╕рж╣ рж╕ржВржмрж╛ржж рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...');
        $this->createNewspaperPosts($categories, $tags, $author);

        $this->command->info('тЬЕ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржВржмрж╛ржжржкрждрзНрж░ ржХржирзНржЯрзЗржирзНржЯ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ!');
    }

    /**
     * Create newspaper categories
     */
    protected function createCategories(): array
    {
        $categoryData = [
            [
                'name' => 'рж░рж╛ржЬржирзАрждрж┐',
                'slug' => 'rajniti',
                'description' => 'рж╕рж░рзНржмрж╢рзЗрж╖ рж░рж╛ржЬржирзИрждрж┐ржХ рж╕ржВржмрж╛ржж ржПржмржВ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг',
            ],
            [
                'name' => 'ржмрзНржпржмрж╕рж╛-ржмрж╛ржгрж┐ржЬрзНржп',
                'slug' => 'business',
                'description' => 'ржмрзНржпржмрж╕рж╛ рж╕ржВржмрж╛ржж, ржмрж╛ржЬрж╛рж░ ржПржмржВ ржЕрж░рзНржержирзАрждрж┐',
            ],
            [
                'name' => 'ржкрзНрж░ржпрзБржХрзНрждрж┐',
                'slug' => 'technology',
                'description' => 'ржкрзНрж░ржпрзБржХрзНрждрж┐ рж╕ржВржмрж╛ржж, ржЧрзНржпрж╛ржЬрзЗржЯ ржПржмржВ ржЙржжрзНржнрж╛ржмржи',
            ],
            [
                'name' => 'ржЦрзЗрж▓рж╛ржзрзБрж▓рж╛',
                'slug' => 'sports',
                'description' => 'ржЦрзЗрж▓рж╛ржзрзБрж▓рж╛ рж╕ржВржмрж╛ржж ржПржмржВ ржЖржкржбрзЗржЯ',
            ],
            [
                'name' => 'ржмрж┐ржирзЛржжржи',
                'slug' => 'entertainment',
                'description' => 'ржмрж┐ржирзЛржжржи, ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░, рж╕ржВржЧрзАржд ржПржмржВ рж╕рзЗрж▓рж┐ржмрзНрж░рж┐ржЯрж┐ ржЦржмрж░',
            ],
            [
                'name' => 'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ',
                'slug' => 'world-news',
                'description' => 'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ рж╕ржВржмрж╛ржж ржПржмржВ ржмрзИрж╢рзНржмрж┐ржХ ржмрж┐рж╖ржпрж╝рж╛ржмрж▓рзА',
            ],
            [
                'name' => 'ржмрж┐ржЬрзНржЮрж╛ржи',
                'slug' => 'science',
                'description' => 'ржмрж┐ржЬрзНржЮрж╛ржи ржЖржмрж┐рж╖рзНржХрж╛рж░ ржПржмржВ ржЧржмрзЗрж╖ржгрж╛',
            ],
            [
                'name' => 'ржорждрж╛ржоржд',
                'slug' => 'opinion',
                'description' => 'ржорждрж╛ржоржд ржПржмржВ рж╕ржорзНржкрж╛ржжржХрзАржпрж╝',
            ],
        ];

        $categories = [];
        foreach ($categoryData as $data) {
            $category = BlogCategory::firstOrCreate(
                ['slug' => $data['slug']],
                array_merge($data, [
                    'is_active' => true,
                    'sort_order' => count($categories) + 1,
                ])
            );
            $categories[] = $category;
            $this->command->info("  тЬУ ржмрж┐ржнрж╛ржЧ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ: {$category->name}");
        }

        return $categories;
    }

    /**
     * Create newspaper tags
     */
    protected function createTags(): array
    {
        $tagNames = [
            'ржЬрж░рзБрж░рж┐ рж╕ржВржмрж╛ржж',
            'ржмрж┐рж╢рзНрж▓рзЗрж╖ржг',
            'ржЕржирзБрж╕ржирзНржзрж╛ржи',
            'ржПржХрзНрж╕ржХрзНрж▓рзБрж╕рж┐ржн',
            'рж╕рж╛ржХрзНрж╖рж╛рзОржХрж╛рж░',
            'ржлрж┐ржЪрж╛рж░',
            'рж╕рзНржерж╛ржирзАржпрж╝',
            'ржЬрж╛рждрзАржпрж╝',
            'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ',
            'рж╕ржорзНржкрж╛ржжржХрзАржпрж╝',
            'ржоржирзНрждржмрзНржп',
            'ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛',
            'ржкрзНрж░рзЛржлрж╛ржЗрж▓',
            'ржкрзНрж░рждрж┐ржмрзЗржжржи',
            'ржЖржкржбрзЗржЯ',
        ];

        $tags = [];
        foreach ($tagNames as $name) {
            $tag = Tag::firstOrCreate(
                ['slug' => Str::slug($name)],
                [
                    'name' => $name,
                    'is_active' => true,
                ]
            );
            $tags[] = $tag;
        }

        $this->command->info("  тЬУ " . count($tags) . " ржЯрж┐ ржЯрзНржпрж╛ржЧ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ");
        return $tags;
    }

    /**
     * Download topic-related image from public API
     */
    protected function downloadImageFromApi(string $topic, int $width = 1200, int $height = 800): ?UploadedFile
    {
        try {
            // Using Picsum Photos - reliable free public image API
            $url = "https://picsum.photos/{$width}/{$height}";

            $this->command->info("  '{$topic}' ржмрж┐рж╖ржпрж╝рзЗрж░ ржЫржмрж┐ ржбрж╛ржЙржирж▓рзЛржб рж╣ржЪрзНржЫрзЗ...");

            // Download image with redirects enabled
            $response = Http::timeout(30)->get($url);

            if (!$response->successful()) {
                $this->command->warn("  API ржерзЗржХрзЗ ржЫржмрж┐ ржбрж╛ржЙржирж▓рзЛржб ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗ");
                return null;
            }

            // Create temporary file
            $tempPath = tempnam(sys_get_temp_dir(), 'newspaper_img_');
            $tempFile = $tempPath . '.jpg';
            rename($tempPath, $tempFile);

            // Save downloaded content
            file_put_contents($tempFile, $response->body());

            // Create UploadedFile instance
            return new UploadedFile(
                $tempFile,
                'newspaper_' . time() . '_' . uniqid() . '.jpg',
                'image/jpeg',
                null,
                true
            );
        } catch (\Exception $e) {
            $this->command->error("  ржЫржмрж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛: {$e->getMessage()}");
            return null;
        }
    }

    /**
     * Generate random Bangla title
     */
    protected function generateBanglaTitle(string $category): string
    {
        $titlePatterns = [
            'рж░рж╛ржЬржирзАрждрж┐' => [
                'рж╕рж░ржХрж╛рж░рзЗрж░ ржирждрзБржи {ржмрж┐рж╖ржпрж╝} ржирзАрждрж┐ ржШрзЛрж╖ржгрж╛',
                '{рж╕рзНржерж╛ржи}рзЗ {ржШржЯржирж╛} ржирж┐ржпрж╝рзЗ ржЙрждрзНрждрзЗржЬржирж╛',
                'рж░рж╛ржЬржирзИрждрж┐ржХ {ржмрж┐рж╖ржпрж╝} ржирж┐ржпрж╝рзЗ ржЖрж▓рзЛржЪржирж╛',
                '{ржжрж▓} ржПрж░ ржирждрзБржи {ржкржжржХрзНрж╖рзЗржк}',
                'ржЬрж╛рждрзАржпрж╝ {ржмрж┐рж╖ржпрж╝} ржХржорж┐ржЯрж┐ ржЧржаржи',
            ],
            'ржмрзНржпржмрж╕рж╛-ржмрж╛ржгрж┐ржЬрзНржп' => [
                '{ржЦрж╛ржд}рзЗ {ржкрж░рж┐ржмрж░рзНрждржи} рж▓ржХрзНрж╖ржгрзАржпрж╝',
                'рж╢рзЗржпрж╝рж╛рж░ржмрж╛ржЬрж╛рж░рзЗ {ржЕржмрж╕рзНржерж╛}',
                '{ржХрзЛржорзНржкрж╛ржирж┐} ржПрж░ ржирждрзБржи {ржЙржжрзНржпрзЛржЧ}',
                '{ржкржгрзНржп} ржПрж░ ржжрж╛ржо {ржкрж░рж┐ржмрж░рзНрждржи}',
                'ржмрзНржпржмрж╕рж╛ржпрж╝рзАржжрзЗрж░ {ржжрж╛ржмрж┐} ржкрзВрж░ржгрзЗрж░ ржЖрж╣рзНржмрж╛ржи',
            ],
            'ржкрзНрж░ржпрзБржХрзНрждрж┐' => [
                'ржирждрзБржи {ржкрзНрж░ржпрзБржХрзНрждрж┐} ржЙржжрзНржнрж╛ржмржи',
                '{ржХрзЛржорзНржкрж╛ржирж┐} ржПрж░ {ржкржгрзНржп} ржмрж╛ржЬрж╛рж░рзЗ',
                'ржбрж┐ржЬрж┐ржЯрж╛рж▓ {рж╕рзЗржмрж╛} ржЪрж╛рж▓рзБ',
                '{ржкрзНрж░ржпрзБржХрзНрждрж┐} ржЦрж╛рждрзЗ {ржЙржирзНржиржпрж╝ржи}',
                'ржХрзГрждрзНрж░рж┐ржо ржмрзБржжрзНржзрж┐ржорждрзНрждрж╛ржпрж╝ {ржЕржЧрзНрж░ржЧрждрж┐}',
            ],
            'ржЦрзЗрж▓рж╛ржзрзБрж▓рж╛' => [
                '{ржжрж▓} ржПрж░ {ржлрж▓рж╛ржлрж▓}',
                '{ржЦрзЗрж▓рзЛржпрж╝рж╛ржбрж╝} ржПрж░ {рж╕рж╛ржлрж▓рзНржп}',
                'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ {ржкрзНрж░рждрж┐ржпрзЛржЧрж┐рждрж╛}ржпрж╝ {ржлрж▓рж╛ржлрж▓}',
                '{ржЦрзЗрж▓рж╛} ржЯрзБрж░рзНржирж╛ржорзЗржирзНржЯрзЗ {ржШржЯржирж╛}',
                'ржЬрж╛рждрзАржпрж╝ ржжрж▓рзЗрж░ {ржЕржмрж╕рзНржерж╛}',
            ],
            'ржмрж┐ржирзЛржжржи' => [
                'ржирждрзБржи {ржорж╛ржзрзНржпржо} ржорзБржХрзНрждрж┐ ржкрзЗрж▓',
                '{рж╢рж┐рж▓рзНржкрзА} ржПрж░ {ржХрж╛ржЬ} ржкрзНрж░рж╢ржВрж╕рж┐ржд',
                '{ржЕржирзБрж╖рзНржарж╛ржи}рзЗ {ржШржЯржирж╛}',
                'ржмрж┐ржирзЛржжржи ржЬржЧрждрзЗ {ржЦржмрж░}',
                '{ржкрзБрж░рж╕рзНржХрж╛рж░} ржкрзЗрж▓рзЗржи {рж╢рж┐рж▓рзНржкрзА}',
            ],
        ];

        $replacements = [
            '{ржмрж┐рж╖ржпрж╝}' => ['рж╢рж┐ржХрзНрж╖рж╛', 'рж╕рзНржмрж╛рж╕рзНржерзНржп', 'ржХрзГрж╖рж┐', 'ржЕрж░рзНржержирзИрждрж┐ржХ', 'рж╕рж╛ржорж╛ржЬрж┐ржХ', 'ржкрж░рж┐ржмрзЗрж╢'],
            '{рж╕рзНржерж╛ржи}' => ['ржврж╛ржХрж╛', 'ржЪржЯрзНржЯржЧрзНрж░рж╛ржо', 'рж╕рж┐рж▓рзЗржЯ', 'рж░рж╛ржЬрж╢рж╛рж╣рзА', 'ржЦрзБрж▓ржирж╛', 'ржмрж░рж┐рж╢рж╛рж▓'],
            '{ржШржЯржирж╛}' => ['рж╕ржорж╛ржмрзЗрж╢', 'ржмрж┐ржХрзНрж╖рзЛржн', 'рж╕ржнрж╛', 'ржХрж░рзНржорж╕рзВржЪрж┐', 'ржЖржирзНржжрзЛрж▓ржи'],
            '{ржжрж▓}' => ['рж╕рж░ржХрж╛рж░рж┐ ржжрж▓', 'ржмрж┐рж░рзЛржзрзА ржжрж▓', 'рж░рж╛ржЬржирзИрждрж┐ржХ ржЬрзЛржЯ'],
            '{ржкржжржХрзНрж╖рзЗржк}' => ['ржХрж░рзНржорж╕рзВржЪрж┐ ржШрзЛрж╖ржгрж╛', 'ржирзАрждрж┐ржорж╛рж▓рж╛ ржкрзНрж░ржгржпрж╝ржи', 'рж╕ржВрж╕рзНржХрж╛рж░ ржкрж░рж┐ржХрж▓рзНржкржирж╛'],
            '{ржЦрж╛ржд}' => ['ржмрзНржпрж╛ржВржХрж┐ржВ', 'ржЯрзЗрж▓рж┐ржпрзЛржЧрж╛ржпрзЛржЧ', 'ржкрзЛрж╢рж╛ржХ', 'ржХрзГрж╖рж┐', 'ржкрзНрж░ржпрзБржХрзНрждрж┐'],
            '{ржкрж░рж┐ржмрж░рзНрждржи}' => ['ржЙржирзНржирждрж┐', 'ржкрзНрж░ржмрзГржжрзНржзрж┐', 'рж╕ржорзНржкрзНрж░рж╕рж╛рж░ржг', 'рж░рзВржкрж╛ржирзНрждрж░'],
            '{ржЕржмрж╕рзНржерж╛}' => ['рж░рзЗржХрж░рзНржб ржЙрждрзНржерж╛ржи', 'рж╕рзНржерж┐рждрж┐рж╢рзАрж▓рждрж╛', 'ржЗрждрж┐ржмрж╛ржЪржХ ржкрзНрж░ржмржгрждрж╛'],
            '{ржХрзЛржорзНржкрж╛ржирж┐}' => ['ржжрзЗрж╢рзАржпрж╝ ржкрзНрж░рждрж┐рж╖рзНржарж╛ржи', 'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ ржХрзЛржорзНржкрж╛ржирж┐', 'рж╕рзНржЯрж╛рж░рзНржЯржЖржк'],
            '{ржЙржжрзНржпрзЛржЧ}' => ['ржкрзНрж░ржХрж▓рзНржк', 'рж╕рзЗржмрж╛', 'ржкржгрзНржп рж▓ржЮрзНржЪ'],
            '{ржкржгрзНржп}' => ['ржЦрж╛ржжрзНржпржкржгрзНржп', 'ржЬрзНржмрж╛рж▓рж╛ржирж┐', 'ржирж┐рждрзНржпржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржжрзНрж░ржмрзНржп'],
            '{ржжрж╛ржмрж┐}' => ['ржирзНржпрж╛ржпрзНржп ржорзВрж▓рзНржп', 'рж╕рзБржмрж┐ржзрж╛ ржмрзГржжрзНржзрж┐', 'рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи'],
            '{ржкрзНрж░ржпрзБржХрзНрждрж┐}' => ['ржорзЛржмрж╛ржЗрж▓', 'рж╕ржлржЯржУржпрж╝рзНржпрж╛рж░', 'рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░', 'ржПржЖржЗ'],
            '{рж╕рзЗржмрж╛}' => ['ржЕрзНржпрж╛ржк', 'ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржо', 'рж╕рж┐рж╕рзНржЯрзЗржо'],
            '{ржЙржирзНржиржпрж╝ржи}' => ['ржЕржЧрзНрж░ржЧрждрж┐', 'ржЙржжрзНржнрж╛ржмржи', 'рж╕рж╛ржлрж▓рзНржп'],
            '{ржЕржЧрзНрж░ржЧрждрж┐}' => ['ржирждрзБржи рж╕рж╛ржлрж▓рзНржп', 'ржпрзБржЧрж╛ржирзНрждржХрж╛рж░рзА ржЙржирзНржиржпрж╝ржи'],
            '{ржжрж▓}' => ['ржЬрж╛рждрзАржпрж╝ ржжрж▓', 'ржХрзНрж▓рж╛ржм ржЯрж┐ржо', 'ржкрзНрж░рж┐ржорж┐ржпрж╝рж╛рж░ рж▓рзАржЧ ржжрж▓'],
            '{ржлрж▓рж╛ржлрж▓}' => ['ржЬржпрж╝', 'ржкрж░рж╛ржЬржпрж╝', 'ржбрзНрж░', 'рж░рзЗржХрж░рзНржб'],
            '{ржЦрзЗрж▓рзЛржпрж╝рж╛ржбрж╝}' => ['рждрж╛рж░ржХрж╛ ржХрзНрж░рж┐ржХрзЗржЯрж╛рж░', 'ржлрзБржЯржмрж▓рж╛рж░', 'ржЕрзНржпрж╛ржерж▓рж┐ржЯ'],
            '{рж╕рж╛ржлрж▓рзНржп}' => ['рж░рзЗржХрж░рзНржб ржнрж╛ржЩрж╛', 'ржкрзБрж░рж╕рзНржХрж╛рж░ ржЬржпрж╝', 'ржжрзБрж░рзНржжрж╛ржирзНржд ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕'],
            '{ржкрзНрж░рждрж┐ржпрзЛржЧрж┐рждрж╛}' => ['ржЪрзНржпрж╛ржорзНржкрж┐ржпрж╝ржирж╢рж┐ржк', 'ржЯрзБрж░рзНржирж╛ржорзЗржирзНржЯ', 'рж▓рзАржЧ'],
            '{ржЦрзЗрж▓рж╛}' => ['ржХрзНрж░рж┐ржХрзЗржЯ', 'ржлрзБржЯржмрж▓', 'ржмрзНржпрж╛ржбржорж┐ржирзНржЯржи'],
            '{ржорж╛ржзрзНржпржо}' => ['ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░', 'ржирж╛ржЯржХ', 'ржЧрж╛ржи', 'ржЕрзНржпрж╛рж▓ржмрж╛ржо'],
            '{рж╢рж┐рж▓рзНржкрзА}' => ['ржЬржиржкрзНрж░рж┐ржпрж╝ рж╢рж┐рж▓рзНржкрзА', 'рждрж╛рж░ржХрж╛ ржЕржнрж┐ржирзЗрждрж╛', 'ржЧрж╛ржпрж╝ржХ'],
            '{ржХрж╛ржЬ}' => ['ржирждрзБржи ржкрзНрж░ржЬрзЗржХрзНржЯ', 'рж╕рж╛ржорзНржкрзНрж░рждрж┐ржХ ржХрж╛ржЬ'],
            '{ржЕржирзБрж╖рзНржарж╛ржи}' => ['ржкрзБрж░рж╕рзНржХрж╛рж░ ржмрж┐рждрж░ржгрзА', 'рж╕рж╛ржВрж╕рзНржХрзГрждрж┐ржХ ржЕржирзБрж╖рзНржарж╛ржи'],
            '{ржЦржмрж░}' => ['ржЪрж╛ржЮрзНржЪрж▓рзНржпржХрж░ ржЦржмрж░', 'ржирждрзБржи рж╕ржВржмрж╛ржж'],
            '{ржкрзБрж░рж╕рзНржХрж╛рж░}' => ['ржЬрж╛рждрзАржпрж╝ ржкрзБрж░рж╕рзНржХрж╛рж░', 'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ рж╕ржорзНржорж╛ржиржирж╛'],
        ];

        $patterns = $titlePatterns[$category] ?? $titlePatterns['рж░рж╛ржЬржирзАрждрж┐'];
        $pattern = $patterns[array_rand($patterns)];

        foreach ($replacements as $placeholder => $options) {
            if (strpos($pattern, $placeholder) !== false) {
                $pattern = str_replace($placeholder, $options[array_rand($options)], $pattern);
            }
        }

        return $pattern;
    }

    /**
     * Generate random Bangla excerpt
     */
    protected function generateBanglaExcerpt(): string
    {
        $excerpts = [
            'рж╕рж╛ржорзНржкрзНрж░рждрж┐ржХ ржШржЯржирж╛ржкрзНрж░ржмрж╛рж╣рзЗ ржПржЗ ржмрж┐рж╖ржпрж╝ржЯрж┐ ржмрж┐рж╢рзЗрж╖ ржЧрзБрж░рзБрждрзНржм ржкрзЗржпрж╝рзЗржЫрзЗред ржмрж┐рж╢рзЗрж╖ржЬрзНржЮрж░рж╛ ржоржирзЗ ржХрж░ржЫрзЗржи ржПржЯрж┐ ржжрзЗрж╢рзЗрж░ ржЙржирзНржиржпрж╝ржирзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржнрзВржорж┐ржХрж╛ ржкрж╛рж▓ржи ржХрж░ржмрзЗред',
            'ржПржЗ ржкржжржХрзНрж╖рзЗржк ржжрзЗрж╢рзЗрж░ рж╕рж╛ржоржЧрзНрж░рж┐ржХ ржЙржирзНржиржпрж╝ржирзЗ ржирждрзБржи ржорж╛рждрзНрж░рж╛ ржпрзЛржЧ ржХрж░ржмрзЗ ржмрж▓рзЗ ржЖрж╢рж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ рж╕ржХрж▓ ржкржХрзНрж╖ ржПржЗ ржЙржжрзНржпрзЛржЧржХрзЗ рж╕рзНржмрж╛ржЧржд ржЬрж╛ржирж┐ржпрж╝рзЗржЫрзЗред',
            'ржжрзАрж░рзНржШржжрж┐ржирзЗрж░ ржкрзНрж░ржЪрзЗрж╖рзНржЯрж╛рж░ ржлрж▓рзЗ ржПржЗ рж╕рж╛ржлрж▓рзНржп ржЕрж░рзНржЬрж┐ржд рж╣ржпрж╝рзЗржЫрзЗред ржПржЯрж┐ рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ рж╕ржХрж▓рзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржмржбрж╝ ржЕрж░рзНржЬржи рж╣рж┐рж╕рзЗржмрзЗ ржмрж┐ржмрзЗржЪрж┐ржд рж╣ржЪрзНржЫрзЗред',
            'ржирждрзБржи ржПржЗ ржЙржжрзНржпрзЛржЧ ржжрзЗрж╢рзЗрж░ ржорж╛ржирзБрж╖рзЗрж░ ржЬрзАржмржиржорж╛ржирзЗ ржЗрждрж┐ржмрж╛ржЪржХ ржкрзНрж░ржнрж╛ржм ржлрзЗрж▓ржмрзЗ ржмрж▓рзЗ ржкрзНрж░рждрзНржпрж╛рж╢рж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред ржмрж┐рж╢рзЗрж╖ржЬрзНржЮрж░рж╛ ржПрж░ рж╕рзБржжрзВрж░ржкрзНрж░рж╕рж╛рж░рзА ржкрзНрж░ржнрж╛ржмрзЗрж░ ржХржерж╛ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рзЗржЫрзЗржиред',
            'ржПржЗ ржШржЯржирж╛ ржжрзЗрж╢рзЗрж░ рж╕рж╛ржорж╛ржЬрж┐ржХ ржУ ржЕрж░рзНржержирзИрждрж┐ржХ ржкрзНрж░рзЗржХрзНрж╖рж╛ржкржЯрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржкрзНрж░ржнрж╛ржм ржлрзЗрж▓ржмрзЗред рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ ржХрж░рзНрждрзГржкржХрзНрж╖ ржмрж┐рж╖ржпрж╝ржЯрж┐ ржЧрзБрж░рзБрждрзНржмрзЗрж░ рж╕рж╛ржерзЗ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░ржЫрзЗред',
            'ржжрзЗрж╢рзЗрж░ ржЙржирзНржиржпрж╝ржи ржУ ржЕржЧрзНрж░ржЧрждрж┐рждрзЗ ржПржЗ ржкржжржХрзНрж╖рзЗржк ржорж╛ржЗрж▓ржлрж▓ржХ рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗред рж╕ржХрж▓ ржорж╣рж▓ ржерзЗржХрзЗ ржПрж░ ржЗрждрж┐ржмрж╛ржЪржХ рж╕рж╛ржбрж╝рж╛ ржкрж╛ржУржпрж╝рж╛ ржЧрзЗржЫрзЗред',
            'ржПржЗ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржжрзЗрж╢рзЗрж░ ржнржмрж┐рж╖рзНржпрзО ржЙржирзНржиржпрж╝ржирзЗрж░ ржкржержХрзЗ ржЖрж░ржУ рж╕рзБржЧржо ржХрж░ржмрзЗ ржмрж▓рзЗ ржоржирзЗ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред ржмрж┐рж╢рзНрж▓рзЗрж╖ржХрж░рж╛ ржПржЯрж┐ржХрзЗ ржпрзБржЧрж╛ржирзНрждржХрж╛рж░рзА ржкржжржХрзНрж╖рзЗржк рж╣рж┐рж╕рзЗржмрзЗ ржЕржнрж┐рж╣рж┐ржд ржХрж░рзЗржЫрзЗржиред',
            'рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ рж╕ржХрж▓ ржкржХрзНрж╖рзЗрж░ рж╕ржоржирзНржмрж┐ржд ржкрзНрж░ржЪрзЗрж╖рзНржЯрж╛ржпрж╝ ржПржЗ рж╕рж╛ржлрж▓рзНржп ржЕрж░рзНржЬрж┐ржд рж╣ржпрж╝рзЗржЫрзЗред ржПржЯрж┐ ржжрзЗрж╢рзЗрж░ рж╕ржХрзНрж╖ржорждрж╛ ржУ рж╕ржорзНржнрж╛ржмржирж╛рж░ ржЙржЬрзНржЬрзНржмрж▓ ржжрзГрж╖рзНржЯрж╛ржирзНрждред',
        ];

        return $excerpts[array_rand($excerpts)];
    }

    /**
     * Generate random Bangla content
     */
    protected function generateBanglaContent(): string
    {
        $headings = [
            'ржкрзНрж░рзЗржХрзНрж╖рж╛ржкржЯ',
            'ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрж┐ржмрж░ржг',
            'ржкрзНрж░ржзрж╛ржи ржмрзИрж╢рж┐рж╖рзНржЯрзНржп',
            'ржмрж┐рж╢рзЗрж╖ржЬрзНржЮ ржорждрж╛ржоржд',
            'ржкрзНрж░ржнрж╛ржм ржУ рж╕ржорзНржнрж╛ржмржирж╛',
            'ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк',
            'рж╕рж╛ржоржЧрзНрж░рж┐ржХ ржорзВрж▓рзНржпрж╛ржпрж╝ржи',
            'ржнржмрж┐рж╖рзНржпрзО ржкрж░рж┐ржХрж▓рзНржкржирж╛'
        ];

        $paragraphs = [
            'ржПржЗ ржмрж┐рж╖ржпрж╝ржЯрж┐ ржжрзАрж░рзНржШржжрж┐ржи ржзрж░рзЗ ржЖрж▓рзЛржЪржирж╛ржпрж╝ ржЫрж┐рж▓ред рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ рж╕ржХрж▓ ржкржХрзНрж╖рзЗрж░ рж╕рж╛ржерзЗ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЖрж▓рзЛржЪржирж╛рж░ ржкрж░ ржПржЗ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржмрж┐рж╢рзЗрж╖ржЬрзНржЮрж░рж╛ ржоржирзЗ ржХрж░ржЫрзЗржи ржПржЯрж┐ ржПржХржЯрж┐ рж╕ржоржпрж╝рзЛржкржпрзЛржЧрзА ржПржмржВ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкржжржХрзНрж╖рзЗржкред',
            'ржПржЗ ржЙржжрзНржпрзЛржЧрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржжрзЗрж╢рзЗрж░ рж╕рж╛ржоржЧрзНрж░рж┐ржХ ржЙржирзНржиржпрж╝ржирзЗ ржирждрзБржи ржЧрждрж┐ рж╕ржЮрзНржЪрж╛рж░ рж╣ржмрзЗред ржмрж┐ржнрж┐ржирзНржи ржЦрж╛рждрзЗ ржПрж░ ржЗрждрж┐ржмрж╛ржЪржХ ржкрзНрж░ржнрж╛ржм ржкржбрж╝ржмрзЗ ржмрж▓рзЗ ржЖрж╢рж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ ржХрж░рзНрждрзГржкржХрзНрж╖ ржПрж░ рж╕ржлрж▓ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржирзЗ ржкрзНрж░рждрж┐рж╢рзНрж░рзБрждрж┐ржмржжрзНржзред',
            'ржкрзНрж░рж╛ржержорж┐ржХ ржкрж░рзНржпрж╛ржпрж╝рзЗ ржХрж┐ржЫрзБ ржЪрзНржпрж╛рж▓рзЗржЮрзНржЬ ржерж╛ржХрж▓рзЗржУ ржзрзАрж░рзЗ ржзрзАрж░рзЗ рждрж╛ ржХрж╛ржЯрж┐ржпрж╝рзЗ ржУржарж╛ рж╕ржорзНржнржм рж╣ржмрзЗред рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ рж╕ржХрж▓рзЗрж░ рж╕рж╣ржпрзЛржЧрж┐рждрж╛ржпрж╝ ржПржЗ рж▓ржХрзНрж╖рзНржп ржЕрж░рзНржЬржи ржХрж░рж╛ ржпрж╛ржмрзЗ ржмрж▓рзЗ ржмрж┐рж╢рзЗрж╖ржЬрзНржЮрж░рж╛ ржЖрж╢рж╛ржмрж╛ржжрзАред',
            'ржПржЗ ржкржжржХрзНрж╖рзЗржк ржжрзЗрж╢рзЗрж░ ржЖрж░рзНрже-рж╕рж╛ржорж╛ржЬрж┐ржХ ржЙржирзНржиржпрж╝ржирзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржнрзВржорж┐ржХрж╛ ржкрж╛рж▓ржи ржХрж░ржмрзЗред ржЬржиржЧржгрзЗрж░ ржЬрзАржмржиржорж╛ржи ржЙржирзНржиржпрж╝ржирзЗ ржПрж░ рж╕рзБржжрзВрж░ржкрзНрж░рж╕рж╛рж░рзА ржкрзНрж░ржнрж╛ржм рж░ржпрж╝рзЗржЫрзЗред рж╕рж░ржХрж╛рж░ ржПрж░ рж╕ржлрж▓ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржирзЗ рж╕рж░рзНржмрж╛рждрзНржоржХ рж╕рж╣ржпрзЛржЧрж┐рждрж╛ ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗред',
            'ржмрж┐рж╢рзНрж▓рзЗрж╖ржХрж░рж╛ ржПржЗ ржЙржжрзНржпрзЛржЧржХрзЗ ржЕрждрзНржпржирзНржд ржЗрждрж┐ржмрж╛ржЪржХ ржжрзГрж╖рзНржЯрж┐рждрзЗ ржжрзЗржЦржЫрзЗржиред рждрж╛рж░рж╛ ржоржирзЗ ржХрж░рзЗржи ржПржЯрж┐ ржжрзЗрж╢рзЗрж░ ржЙржирзНржиржпрж╝ржи ржпрж╛рждрзНрж░рж╛ржпрж╝ ржПржХржЯрж┐ ржорж╛ржЗрж▓ржлрж▓ржХ рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗред ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ ржорж╣рж▓рзЗржУ ржПрж░ ржкрзНрж░рж╢ржВрж╕рж╛ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред',
            'рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ ржХрж░рзНрждрзГржкржХрзНрж╖ ржПржЗ ржмрж┐рж╖ржпрж╝рзЗ рж╕рж░рзНржмрзЛржЪрзНржЪ ржЧрзБрж░рзБрждрзНржм ржжрж┐ржпрж╝рзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗред ржирж┐ржпрж╝ржорж┐ржд ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржПржмржВ ржорзВрж▓рзНржпрж╛ржпрж╝ржирзЗрж░ ржорж╛ржзрзНржпржорзЗ ржПрж░ ржХрж╛рж░рзНржпржХрж╛рж░рж┐рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ рж╣ржмрзЗред ржкрзНрж░ржпрж╝рзЛржЬржирзЗ рж╕ржоржпрж╝ржорждрзЛ рж╕ржВрж╢рзЛржзржирзА ржкржжржХрзНрж╖рзЗржк ржирзЗржУржпрж╝рж╛ рж╣ржмрзЗред',
            'ржПржЗ ржЙржжрзНржпрзЛржЧ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржирзЗ ржЬржиржЧржгрзЗрж░ рж╕ржХрзНрж░рж┐ржпрж╝ ржЕржВрж╢ржЧрзНрж░рж╣ржг ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред рж╕ржЪрзЗрждржирждрж╛ ржмрзГржжрзНржзрж┐ ржПржмржВ рж╕рж╣ржпрзЛржЧрж┐рждрж╛рж░ ржорж╛ржзрзНржпржорзЗ ржПрж░ рж╕ржлрж▓рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ рж╕ржорзНржнржмред рж╕ржХрж▓ ржорж╣рж▓ржХрзЗ ржПржЧрж┐ржпрж╝рзЗ ржЖрж╕рж╛рж░ ржЖрж╣рзНржмрж╛ржи ржЬрж╛ржирж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗред',
            'ржжрзАрж░рзНржШржорзЗржпрж╝рж╛ржжрзА ржкрж░рж┐ржХрж▓рзНржкржирж╛рж░ ржЕржВрж╢ рж╣рж┐рж╕рзЗржмрзЗ ржПржЗ ржкржжржХрзНрж╖рзЗржк ржирзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржнржмрж┐рж╖рзНржпрждрзЗ ржПрж░ ржЖрж░ржУ рж╕ржорзНржкрзНрж░рж╕рж╛рж░ржг ржПржмржВ ржЙржирзНржиржпрж╝ржирзЗрж░ ржкрж░рж┐ржХрж▓рзНржкржирж╛ рж░ржпрж╝рзЗржЫрзЗред ржмрж┐рж╢рзЗрж╖ржЬрзНржЮржжрзЗрж░ ржкрж░рж╛ржорж░рзНрж╢ ржЕржирзБржпрж╛ржпрж╝рзА ржПржЧрж┐ржпрж╝рзЗ ржпрж╛ржУржпрж╝рж╛ рж╣ржмрзЗред',
        ];

        $content = '';
        $numSections = rand(3, 5);

        for ($i = 0; $i < $numSections; $i++) {
            $heading = $headings[array_rand($headings)];
            $content .= "<h2>{$heading}</h2>";

            $numParagraphs = rand(2, 3);
            for ($j = 0; $j < $numParagraphs; $j++) {
                $paragraph = $paragraphs[array_rand($paragraphs)];
                $content .= "<p>{$paragraph}</p>";
            }
        }

        return $content;
    }

    /**
     * Create newspaper posts with Bangla content
     */
    protected function createNewspaperPosts(array $categories, array $tags, User $author): void
    {
        // Generate random number of posts (30-50)
        $totalPosts = rand(30, 50);

        $this->command->info("  {$totalPosts} ржЯрж┐ рж╕ржВржмрж╛ржж рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржмрзЗ...");

        $progressBar = $this->command->getOutput()->createProgressBar($totalPosts);
        $progressBar->start();

        for ($i = 0; $i < $totalPosts; $i++) {
            try {
                // Select random category
                $category = $categories[array_rand($categories)];

                // Generate random content
                $title = $this->generateBanglaTitle($category->name);
                $excerpt = $this->generateBanglaExcerpt();
                $content = $this->generateBanglaContent();

                // Download and process image
                $mediaId = null;
                $imageFile = $this->downloadImageFromApi($category->name);

                if ($imageFile) {
                    try {
                        $media = ImageService::processUniversalUpload($imageFile, [
                            'scope' => 'global',
                            'compression' => 75,
                        ]);
                        $mediaId = $media->id;

                        // Clean up temp file
                        @unlink($imageFile->getPathname());
                    } catch (\Exception $e) {
                        $this->command->warn("\n  ржЫржмрж┐ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржХрж░рждрзЗ ржмрзНржпрж░рзНрже: {$e->getMessage()}");
                    }
                }

                // Select random tags (2-4 tags)
                $numTags = rand(2, 4);
                $postTags = collect($tags)
                    ->random(min($numTags, count($tags)))
                    ->pluck('id')
                    ->toArray();

                // Prepare post data
                $postData = [
                    'title' => $title,
                    'slug' => Str::slug($title),
                    'excerpt' => $excerpt,
                    'content' => $content,
                    'author_id' => $author->id,
                    'media_id' => $mediaId,
                    'status' => 'published',
                    'published_at' => now()->subDays(rand(1, 60)),
                    'is_featured' => rand(1, 5) === 1, // 20% chance of being featured
                    'allow_comments' => true,
                    'views_count' => rand(500, 15000),
                    'categories' => [$category->id],
                    'tags' => $postTags,
                ];

                // Create post using PostService
                $post = $this->postService->createPost($postData);

                $progressBar->advance();
            } catch (\Exception $e) {
                $this->command->error("\n  ржкрзЛрж╕рзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржмрзНржпрж░рзНрже");
                $this->command->error("  рж╕ржорж╕рзНржпрж╛: {$e->getMessage()}");
                $progressBar->advance();
            }
        }

        $progressBar->finish();
        $this->command->info("\nтЬЕ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржВржмрж╛ржж рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ!");
    }
}
